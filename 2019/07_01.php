<?php

$permutations = [
[1,2,3,4,0],[1,2,3,0,4],[1,2,4,3,0],[1,2,4,0,3],[1,2,0,3,4],[1,2,0,4,3],[1,3,2,4,0],[1,3,2,0,4],[1,3,4,2,0],[1,3,4,0,2],[1,3,0,2,4],[1,3,0,4,2],[1,4,2,3,0],[1,4,2,0,3],[1,4,3,2,0],[1,4,3,0,2],[1,4,0,2,3],[1,4,0,3,2],[1,0,2,3,4],[1,0,2,4,3],[1,0,3,2,4],[1,0,3,4,2],[1,0,4,2,3],[1,0,4,3,2],[2,1,3,4,0],[2,1,3,0,4],[2,1,4,3,0],[2,1,4,0,3],[2,1,0,3,4],[2,1,0,4,3],[2,3,1,4,0],[2,3,1,0,4],[2,3,4,1,0],[2,3,4,0,1],[2,3,0,1,4],[2,3,0,4,1],[2,4,1,3,0],[2,4,1,0,3],[2,4,3,1,0],[2,4,3,0,1],[2,4,0,1,3],[2,4,0,3,1],[2,0,1,3,4],[2,0,1,4,3],[2,0,3,1,4],[2,0,3,4,1],[2,0,4,1,3],[2,0,4,3,1],[3,1,2,4,0],[3,1,2,0,4],[3,1,4,2,0],[3,1,4,0,2],[3,1,0,2,4],[3,1,0,4,2],[3,2,1,4,0],[3,2,1,0,4],[3,2,4,1,0],[3,2,4,0,1],[3,2,0,1,4],[3,2,0,4,1],[3,4,1,2,0],[3,4,1,0,2],[3,4,2,1,0],[3,4,2,0,1],[3,4,0,1,2],[3,4,0,2,1],[3,0,1,2,4],[3,0,1,4,2],[3,0,2,1,4],[3,0,2,4,1],[3,0,4,1,2],[3,0,4,2,1],[4,1,2,3,0],[4,1,2,0,3],[4,1,3,2,0],[4,1,3,0,2],[4,1,0,2,3],[4,1,0,3,2],[4,2,1,3,0],[4,2,1,0,3],[4,2,3,1,0],[4,2,3,0,1],[4,2,0,1,3],[4,2,0,3,1],[4,3,1,2,0],[4,3,1,0,2],[4,3,2,1,0],[4,3,2,0,1],[4,3,0,1,2],[4,3,0,2,1],[4,0,1,2,3],[4,0,1,3,2],[4,0,2,1,3],[4,0,2,3,1],[4,0,3,1,2],[4,0,3,2,1],[0,1,2,3,4],[0,1,2,4,3],[0,1,3,2,4],[0,1,3,4,2],[0,1,4,2,3],[0,1,4,3,2],[0,2,1,3,4],[0,2,1,4,3],[0,2,3,1,4],[0,2,3,4,1],[0,2,4,1,3],[0,2,4,3,1],[0,3,1,2,4],[0,3,1,4,2],[0,3,2,1,4],[0,3,2,4,1],[0,3,4,1,2],[0,3,4,2,1],[0,4,1,2,3],[0,4,1,3,2],[0,4,2,1,3],[0,4,2,3,1],[0,4,3,1,2],[0,4,3,2,1]
];

$puzzle_code = '3,8,1001,8,10,8,105,1,0,0,21,46,55,76,89,106,187,268,349,430,99999,3,9,101,4,9,9,1002,9,2,9,101,5,9,9,1002,9,2,9,101,2,9,9,4,9,99,3,9,1002,9,5,9,4,9,99,3,9,1001,9,2,9,1002,9,4,9,101,2,9,9,1002,9,3,9,4,9,99,3,9,1001,9,3,9,1002,9,2,9,4,9,99,3,9,1002,9,4,9,1001,9,4,9,102,5,9,9,4,9,99,3,9,101,1,9,9,4,9,3,9,102,2,9,9,4,9,3,9,1001,9,2,9,4,9,3,9,101,2,9,9,4,9,3,9,1001,9,1,9,4,9,3,9,101,1,9,9,4,9,3,9,102,2,9,9,4,9,3,9,102,2,9,9,4,9,3,9,1002,9,2,9,4,9,3,9,101,1,9,9,4,9,99,3,9,102,2,9,9,4,9,3,9,1002,9,2,9,4,9,3,9,101,1,9,9,4,9,3,9,101,2,9,9,4,9,3,9,102,2,9,9,4,9,3,9,102,2,9,9,4,9,3,9,102,2,9,9,4,9,3,9,1001,9,1,9,4,9,3,9,101,2,9,9,4,9,3,9,1002,9,2,9,4,9,99,3,9,101,1,9,9,4,9,3,9,101,1,9,9,4,9,3,9,101,2,9,9,4,9,3,9,1002,9,2,9,4,9,3,9,1001,9,2,9,4,9,3,9,1001,9,1,9,4,9,3,9,1001,9,2,9,4,9,3,9,102,2,9,9,4,9,3,9,102,2,9,9,4,9,3,9,102,2,9,9,4,9,99,3,9,101,1,9,9,4,9,3,9,102,2,9,9,4,9,3,9,101,2,9,9,4,9,3,9,101,1,9,9,4,9,3,9,102,2,9,9,4,9,3,9,1002,9,2,9,4,9,3,9,102,2,9,9,4,9,3,9,1001,9,2,9,4,9,3,9,102,2,9,9,4,9,3,9,101,1,9,9,4,9,99,3,9,1001,9,1,9,4,9,3,9,1001,9,1,9,4,9,3,9,102,2,9,9,4,9,3,9,102,2,9,9,4,9,3,9,1001,9,1,9,4,9,3,9,1001,9,1,9,4,9,3,9,1001,9,1,9,4,9,3,9,1002,9,2,9,4,9,3,9,101,2,9,9,4,9,3,9,101,1,9,9,4,9,99';

$test_values = [
	[
		'pss'    => [4,3,2,1,0],
		'code'   => '3,15,3,16,1002,16,10,16,1,16,15,15,4,15,99,0,0',
		'result' => 43210,
	],
	[
		'pss'    => [0,1,2,3,4],
		'code'   => '3,23,3,24,1002,24,10,24,1002,23,-1,23,101,5,23,23,1,24,23,23,4,23,99,0,0',
		'result' => 54321,
	],
	[
		'pss'    => [1,0,4,3,2],
		'code'   => '3,31,3,32,1002,32,10,32,1001,31,-2,31,1007,31,0,33,1002,33,7,33,1,33,31,31,1,32,31,31,4,31,99,0,0,0',
		'result' => 65210,
	],
];

/*
#$output = [];
$command = "/usr/bin/php intcode.php 3,15,3,16,1002,16,10,16,1,16,15,15,4,15,99,0,0 4,3,2,1,0";
$command = "/usr/bin/php intcode.php 3,15,3,16,1002,16,10,16,1,16,15,15,4,15,99,0,0";
#$output = shell_exec ( "echo 1\n2\n | /usr/bin/php intcode.php 3,15,3,16,1002,16,10,16,1,16,15,15,4,15,99,0,0" );
$output = exec($command, $retval);
var_dump($output);
#*/

function run_amps($code, $pss) {
	
	$base_command = "/usr/bin/php intcode.php ";
	$base_command .= $code;
	$cmd = $base_command .' '.$pss[0].',0';

	$result = exec($cmd);
	#var_dump($result);die();
	for($amp = 1; $amp < 5; $amp++) {
		$cmd = $base_command .' '.$pss[$amp].','.$result;
		$result = exec($cmd);
	}
	return $result;
}
/*
foreach($test_values as $test_value) {
	$result = run_amps($test_value['code'], $test_value['pss']);
	var_dump($result);
}*/
$result = [];
foreach($permutations as $permutation) {
	$r = run_amps($puzzle_code, $permutation);
	var_dump($r);
	$result[] = $r;
}
var_dump(max($result));